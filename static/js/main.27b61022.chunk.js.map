{"version":3,"sources":["components/sharedGroup.js","components/inputDrawer.js","App.js","utils/cache.js","index.js"],"names":["items","onChange","its","map","val","className","key","uniqueId","data-id","options","group","animation","props","title","visible","v","isHieghtlight","useState","value","setValue","useEffect","placement","onClose","width","onValueChange","code","highlight","languages","yaml","padding","style","fontFamily","fontSize","borderRadius","backgroundColor","color","fileDownload","require","Header","Content","Sider","Footer","RAW_CONFIG","SUB_CONFIG","PROXIES_CONFIG","IS_FLAT_RULESET","CLASHRESTFULAPI","RULE_TYPES","localPort","client","create","baseURL","headers","useLocalStorage","initValue","c","str","window","localStorage","getItem","JSON","parse","getCache","setItem","stringify","setCache","useDrawerInput","cacheKey","setVisible","t","App","rawConfig","setRawConfig","setRawDrawerVisible","subsURLs","setSubDrawerVisible","syncBtnLoading","setSyncBtnLoading","groupIndex","setGroupIndex","moreFileterStr","setMoreFilterStr","isLocalMode","setIsLocalMode","get","then","data","status","catch","_","subProxies","setSubProxies","isFlatRuleset","setIsFlatRuleset","clashAPI","setClashAPI","rawObj","setRawObj","a","request","url","resp","urls","split","filter","test","proxyURL","all","encodeURIComponent","resps","proxies","forEach","index","yml","ymlParse","p","concat","notification","error","message","description","stack","groups","rules","finalRules","rule","ps","trim","type","proxy","lines","l","payload","args","includes","res","r","finalProxies","allProxyNames","name","g","entries","idx","fileName","fileContent","ymlStringify","method","location","href","put","validateStatus","s","success","info","obj","gs","proxyGroupNames","use","Item","groupProxies","length","moreProxies","exp","RegExp","theme","mode","selectedKeys","lineHeight","onClick","open","background","item","height","borderRight","count","overflowCount","offset","order","placeholder","e","target","allowClear","loading","icon","checked","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.27b61022.chunk.js","sourcesContent":["import React from 'react'\n\nimport Sortable from 'react-sortablejs';\nimport uniqueId from 'lodash/uniqueId';\n\nexport default function ({ items = [], onChange = () => { } }) {\n  const its = items.map(val => {\n    return (\n      <div className=\"menu-item\" key={uniqueId()} data-id={val}>{val}</div>\n    )\n  });\n\n  return (\n    <Sortable\n      options={{\n        group: 'shared',\n        animation: 150,\n      }}\n      onChange={onChange}\n      className=\"menu\"\n    >\n      {its}\n    </Sortable>\n  );\n}","import React, { useState, useEffect } from 'react'\nimport Editor from 'react-simple-code-editor';\nimport { highlight, languages } from 'prismjs/components/prism-core';\nimport 'prismjs/components/prism-yaml';\nimport 'prismjs/components/prism-json'\nimport 'prismjs/themes/prism-okaidia.css'\nimport { Drawer } from 'antd'\n\n\nexport default function (props) {\n    const { title = \"\", visible = false, onChange, 'value': v, isHieghtlight = true } = props\n    const [value, setValue] = useState(v)\n\n    useEffect(() => {\n        setValue(v)\n    }, [v])\n\n    return (\n        <Drawer\n            title={title}\n            placement=\"right\"\n            onClose={() => onChange(value)}\n            visible={visible}\n            width={\"84%\"}\n        >\n            <Editor\n                value={value}\n                onValueChange={code => setValue(code)}\n                highlight={code => isHieghtlight ? highlight(code, languages.yaml, 'yaml') : code}\n                padding={10}\n                style={{\n                    fontFamily: '\"Fira code\", \"Fira Mono\", monospace',\n                    fontSize: 14,\n                    borderRadius: 5,\n                    backgroundColor: \"rgb(40, 44, 52)\",\n                    color: \"#ffffff\"\n                }}\n            />\n        </Drawer>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { Layout, Menu, Button, notification, Empty, Tag, message, Input, Checkbox, Badge } from 'antd'\nimport { parse as ymlParse, stringify as ymlStringify } from 'yaml'\nimport { get, all, create, put } from 'axios'\n\n\nimport SharedGroup from './components/sharedGroup'\nimport RawDrawer from './components/inputDrawer'\n\nimport { setCache, getCache } from \"./utils/cache\"\n\nimport './App.css';\n\nconst fileDownload = require('react-file-download')\n\nconst { Header, Content, Sider, Footer } = Layout;\n\nconst RAW_CONFIG = \"raw\"\nconst SUB_CONFIG = \"subs\"\nconst PROXIES_CONFIG = \"proxies\"\nconst IS_FLAT_RULESET = \"isFlatRules\"\nconst CLASHRESTFULAPI = \"clashAPI\"\n\nconst RULE_TYPES = [\"DOMAIN-SUFFIX\", \"DOMAIN-KEYWORD\", \"DOMAIN\", \"DOMAIN-SUFFIX\", \"IP-CIDR\", \"GEOIP\", \"FINAL\"]\n\nconst localPort = 54637\nconst client = create({\n  baseURL: `http://127.0.0.1:${localPort}`,\n  headers: {\n    'content-type': 'application/x-www-form-urlencoded'\n  }\n})\n\nfunction App() {\n  const rawConfig = useDrawerInput({ title: \"Input raw config.yaml\", cacheKey: RAW_CONFIG })\n  const { 'setValue': setRawConfig, 'setVisible': setRawDrawerVisible } = rawConfig\n  const subsURLs = useDrawerInput({ title: \"Input subscriptions(.yaml) url line by line\", cacheKey: SUB_CONFIG })\n  const { 'setVisible': setSubDrawerVisible } = subsURLs\n  const [syncBtnLoading, setSyncBtnLoading] = useState(false)\n  const [groupIndex, setGroupIndex] = useState(\"0\")\n  const [moreFileterStr, setMoreFilterStr] = useState(\"\")\n\n  const [isLocalMode, setIsLocalMode] = useState(false)\n  useEffect(() => {\n    client.get('/ping').then(({ data = \"\", status }) => {\n      setIsLocalMode(status === 200 && data === \"pong\")\n    }).catch(_ => { })\n  }, [])\n\n  const [subProxies, setSubProxies] = useLocalStorage(PROXIES_CONFIG, [])\n  const [isFlatRuleset, setIsFlatRuleset] = useLocalStorage(IS_FLAT_RULESET, true)\n  const [clashAPI, setClashAPI] = useLocalStorage(CLASHRESTFULAPI, \"\")\n\n  const [rawObj, setRawObj] = useState({})\n  useEffect(() => {\n    let obj = {}\n    try {\n      obj = ymlParse(rawConfig.value)\n    } catch{ }\n    setRawObj(obj || {})\n  }, [rawConfig.value])\n\n  async function handleSyncProxies() {\n    const request = async url => {\n      try {\n        let resp = await get(url)\n        return resp.data\n      } catch {\n        return \"\"\n      }\n    }\n\n    setSyncBtnLoading(true)\n    try {\n      const urls = subsURLs.value.split('\\n').filter(url => /^https?:\\/\\//.test(url))\n      const proxyURL = isLocalMode ? `http://127.0.0.1:${localPort}/proxy?url=` : \"https://cloudcompute.lbyczf.com/proxy-content?url=\"\n      const resps = await all(urls.map(url => request(`${proxyURL}${encodeURIComponent(url)}`)))\n      let proxies = []\n      resps.forEach((data, index) => {\n        if (data === \"\") {\n          notification.error({\n            message: \"Could not download from subscription\",\n            description: urls[index]\n          })\n          return\n        }\n        let yml = {}\n        try {\n          yml = ymlParse(data)\n        } catch{ }\n        const { 'Proxy': p = [] } = yml\n        proxies = proxies.concat(p)\n      })\n      setSubProxies(proxies)\n    } catch (e) {\n      notification.error({\n        message: \"Sync Error\",\n        description: e.stack,\n      })\n    }\n    setSyncBtnLoading(false)\n  }\n\n  function handleProxiesChange(order) {\n    let { 'Proxy Group': gs = [] } = rawObj\n    gs[groupIndex].proxies = order\n    const yml = ymlStringify({ ...rawObj, 'Proxy Group': gs })\n    setRawConfig(yml)\n  }\n\n  function handleMoreFilterChange(e) {\n    const { value } = e.target\n    setMoreFilterStr(value)\n  }\n\n  function handleIsFlatRulesetChange(e) {\n    const { checked = true } = e.target\n    setIsFlatRuleset(checked)\n  }\n\n  function handleClashAPIChange(e) {\n    const { value = \"\" } = e.target\n    setClashAPI(value)\n  }\n\n  async function handleDownloadProfile() {\n    const { 'Proxy': proxies = [], 'Proxy Group': groups = [], 'Rule': rules = [] } = rawObj\n    let finalRules = []\n    for (let rule of rules) {\n      const ps = rule.split(',').map(p => p.trim())\n      const [type, url, proxy] = ps\n      if (type === 'RULE-SET' && isFlatRuleset) {\n        try {\n          const resp = await get(url)\n          const { status, data } = resp\n          if (status === 200) {\n            const lines = data.split('\\n')\n            finalRules = [...finalRules, ...lines.map(l => {\n              const [type, payload, args] = l.split(',').map(p => p.trim())\n              if (!RULE_TYPES.includes(type)) return null;\n              let res = `${type},${payload},${proxy}`\n              if (args === 'no-resolve') {\n                res += \",no-resolve\"\n              }\n              return res\n            }).filter(r => r)]\n          }\n        } catch {\n          notification.error({\n            message: \"Ruleset download failed\",\n            description: url\n          })\n          return\n        }\n      } else {\n        finalRules = [...finalRules, rule]\n      }\n    }\n    const finalProxies = proxies.concat(subProxies)\n    const allProxyNames = [\n      ...finalProxies.map(p => p.name),\n      ...groups.map(g => g.name),\n      ...[\"DIRECT\", \"REJECT\", \"GLOBAL\"]\n    ]\n    for (let [idx, g] of groups.entries()) {\n      const { proxies = [] } = g\n      for (let ps of proxies) {\n        if (!allProxyNames.includes(ps)) {\n          message.error(`Group [${g.name}] contains a not exist proxy [${ps}]`, 5)\n          setGroupIndex(idx + \"\")\n          return\n        }\n      }\n    }\n    const fileName = 'config.yml'\n    const fileContent = ymlStringify({ ...rawObj, 'Proxy': finalProxies, 'Rule': finalRules })\n    if (isLocalMode) {\n      const { 'status': s } = await client({\n        method: \"post\",\n        url: \"/config\",\n        data: \"config=\" + encodeURIComponent(fileContent)\n      })\n      if (s === 204) {\n        window.location.href = `clash://install-config?url=${encodeURIComponent(`http://127.0.0.1:${localPort}/config`)}`\n      }\n    } else if (clashAPI) {\n      try {\n        await put(`${clashAPI}/configs`, { payload: fileContent }, { validateStatus: s => s !== 200 })\n        notification.success({\n          message: \"Done\",\n          description: \"Enjoy your free time.\"\n        })\n      } catch (e) {\n        notification.info({\n          message: \"Could not write profile to Clash\",\n          description: e.stack\n        })\n      }\n    } else {\n      fileDownload(fileContent, fileName)\n    }\n  }\n\n  const { 'Proxy Group': gs = [], 'Proxy': ps = [] } = rawObj\n  const proxyGroupNames = gs.map((g, idx) => {\n    const { use } = g\n    return (\n      <Menu.Item key={idx}>{g.name}</Menu.Item>\n    )\n  })\n\n  let groupProxies = []\n  if (groupIndex < gs.length) {\n    const { proxies = [] } = gs[groupIndex * 1]\n    groupProxies = proxies\n  }\n\n  const moreProxies = [\n    'DIRECT',\n    'GLOBAL',\n    'REJECT',\n    ...gs.map(g => g.name),\n    ...ps.map(p => p.name),\n    ...subProxies.map(p => p.name)\n  ].filter(p => {\n    let exp = /^/\n    try {\n      exp = new RegExp(moreFileterStr)\n    } catch { }\n    return !groupProxies.includes(p) && exp.test(p)\n  })\n\n  return (\n    <Layout className=\"main\">\n      <Header className=\"header\">\n        <Menu\n          theme=\"dark\"\n          mode=\"horizontal\"\n          selectedKeys={['1']}\n          style={{ lineHeight: '64px' }}\n        >\n          <Menu.Item key=\"1\">Proxy Group</Menu.Item>\n          <Menu.Item key=\"2\" onClick={() => setRawDrawerVisible(true)}>Raw Config</Menu.Item>\n          <Menu.Item key=\"3\" onClick={() => setSubDrawerVisible(true)}>Subscription</Menu.Item>\n          <Menu.Item key=\"4\" onClick={() => window.open(\"https://github.com/Fndroid/clash-config-builder\", \"_blank\")}>Github</Menu.Item>\n        </Menu>\n      </Header>\n      <Layout>\n        <Sider width={200} style={{ background: '#fff' }}>\n          <Menu\n            mode=\"inline\"\n            selectedKeys={[groupIndex]}\n            onClick={(item) => setGroupIndex(item.key)}\n            style={{ height: '100%', borderRight: 0 }}\n          >\n            {proxyGroupNames}\n          </Menu>\n        </Sider>\n        <Layout style={{ padding: '0 24px 24px' }}>\n          <Content\n            className=\"content\"\n          >\n            <div className=\"list\">\n              <Badge count={groupProxies.length} overflowCount={2000} offset={[20, 0]} style={{ backgroundColor: '#f50' }}>\n                <div className=\"list-title\">Proxies</div>\n              </Badge>\n              {/* <Empty hidden={groupProxies.length !== 0} /> */}\n              <SharedGroup\n                items={groupProxies}\n                onChange={handleProxiesChange}\n              />\n            </div>\n\n            <div className=\"list\">\n              <Badge count={moreProxies.length} overflowCount={2000} offset={[20, 0]} style={{ backgroundColor: '#52c41a' }}>\n                <div className=\"list-title\">More</div>\n              </Badge>\n              <SharedGroup\n                items={moreProxies}\n                onChange={() => { }}\n              />\n              <Input\n                className=\"filter-input\"\n                placeholder=\"flter by regular expression\"\n                value={moreFileterStr}\n                onChange={handleMoreFilterChange}\n                allowClear\n              ></Input>\n            </div>\n\n          </Content>\n        </Layout>\n      </Layout>\n      <Footer className=\"footer\">\n        <Button className=\"btn\" loading={syncBtnLoading} icon=\"cloud-download\" onClick={handleSyncProxies}>Sync Proxies</Button>\n        <Button className=\"btn\" type=\"primary\" icon=\"download\" onClick={handleDownloadProfile}>Download Profile</Button>\n        <Checkbox className='btn' checked={isFlatRuleset} onChange={handleIsFlatRulesetChange}>Flat Ruleset</Checkbox>\n        <Tag className=\"btn mode-tag\" color={isLocalMode ? \"green\" : \"volcano\"}>{`${isLocalMode ? \"Local\" : \"Remote\"} Mode`}</Tag>\n        <Input value={clashAPI} className=\"input\" placeholder=\"http://127.0.0.1:9090\" onChange={handleClashAPIChange} ></Input>\n      </Footer>\n      <RawDrawer\n        {...rawConfig}\n      ></RawDrawer>\n      <RawDrawer\n        {...subsURLs}\n        isHieghtlight={false}\n      ></RawDrawer>\n    </Layout>\n  );\n}\n\nfunction useLocalStorage(key, initValue) {\n  const c = getCache(key)\n  const [value, setValue] = useState(c === null ? initValue : c)\n\n  function setValueCache(val) {\n    setValue(val)\n    setCache(key, val)\n  }\n\n  return [value, setValueCache]\n}\n\nfunction useDrawerInput({ title, initValue = \"\", cacheKey }) {\n  const [value, setValue] = useLocalStorage(cacheKey, initValue)\n  const [visible, setVisible] = useState(false)\n\n  function handleChange(t) {\n    setVisible(false)\n    setValue(t)\n  }\n\n  return {\n    title,\n    visible,\n    value,\n    onChange: handleChange,\n    setValue,\n    setVisible,\n  }\n}\n\n\nexport default App;\n","function setCache(key, value) {\n    window.localStorage.setItem(key, JSON.stringify(value))\n}\n\nfunction getCache(key) {\n    const str = window.localStorage.getItem(key)\n    try {\n        const obj = JSON.parse(str)\n        return obj\n    } catch{ }\n    return str\n}\n\nexport {\n    setCache,\n    getCache\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}